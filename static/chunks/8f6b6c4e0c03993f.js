(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,98486,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(76009);e.i(36180);var r=e.i(98925),l=e.i(97815),d=e.i(18566);function n(){let{user:e}=(0,l.useAuth)(),n=(0,d.useRouter)(),[c,i]=(0,s.useState)([]),[x,o]=(0,s.useState)(!0),[p,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!1),[b,g]=(0,s.useState)("reject"),[j,f]=(0,s.useState)(""),[y,N]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(!e)return;(async()=>{let t=await (0,r.getDoc)((0,r.doc)(a.db,"users",e.uid));if(t.exists()){let s=t.data();if("mohemad123hsak@gmail.com"!==e.email&&!s.adminPermissions?.manage_finance)return n.push("/admin")}else if("mohemad123hsak@gmail.com"!==e.email)return n.push("/admin")})();let t=(0,r.query)((0,r.collection)(a.db,"transactions"),(0,r.where)("type","==","deposit"),(0,r.orderBy)("createdAt","desc")),s=(0,r.onSnapshot)(t,e=>{i(e.docs.map(e=>({id:e.id,...e.data()}))),o(!1)});return()=>s()},[e,n]);let w=async e=>{if(confirm(`هل أنت متأكد من تحويل ${e.amount} ج.م إلى حساب ${e.userName}؟`)){N(!0);try{let t=(0,r.doc)(a.db,"users",e.userId);await (0,r.updateDoc)(t,{balance:(0,r.increment)(e.amount)});let s=(0,r.doc)(a.db,"transactions",e.id);await (0,r.updateDoc)(s,{status:"completed",updatedAt:(0,r.serverTimestamp)()}),await (0,r.addDoc)((0,r.collection)(a.db,"notifications"),{recipientId:e.userId,title:"✅ تم شحن رصيدك",message:`مبروك أيها الملك! تم إضافة ${e.amount} ج.م إلى حسابك بنجاح. رصيدك الآن جاهز للمراهنات.`,type:"transaction",status:"unread",createdAt:(0,r.serverTimestamp)()}),alert("تم شحن الرصيد بنجاح!")}catch(e){console.error(e),alert("حدث خطأ أثناء معالجة الطلب.")}finally{N(!1)}}},v=async()=>{if(p&&j){N(!0);try{let e="reject"===b?"rejected":"suspended",t=(0,r.doc)(a.db,"transactions",p.id);await (0,r.updateDoc)(t,{status:e,reason:j,updatedAt:(0,r.serverTimestamp)()}),await (0,r.addDoc)((0,r.collection)(a.db,"notifications"),{recipientId:p.userId,title:"rejected"===e?"❌ رفض طلب الإيداع":"⏳ تعليق طلب الإيداع",message:"rejected"===e?`عذراً أيها الملك، تم رفض طلب إيداعك بقيمة ${p.amount} ج.م. السبب: ${j}`:`أيها الملك، تم تعليق طلب إيداعك بقيمة ${p.amount} ج.م للمراجعة. السبب: ${j}`,type:"transaction",status:"unread",createdAt:(0,r.serverTimestamp)()}),h(!1),u(null),f(""),alert("تم تحديث حالة الطلب بنجاح.")}catch(e){console.error(e),alert("حدث خطأ أثناء التحديث.")}finally{N(!1)}}};return x?(0,t.jsx)("div",{className:"p-10 text-center text-[#D4AF37]",children:"جاري تحميل الطلبات..."}):(0,t.jsxs)("div",{className:"space-y-8 animate-in fade-in duration-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-3xl font-black font-pharaoh tracking-widest text-[#FFD700]",children:"طلبات الإيداع"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm mt-1 uppercase tracking-tighter",children:"إدارة شحن الأرصدة لسكان المملكة"})]}),(0,t.jsx)("div",{className:"bg-[#0a0a0a] border border-[#D4AF37]/20 rounded-[40px] overflow-hidden shadow-2xl",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-right",children:[(0,t.jsx)("thead",{className:"bg-[#D4AF37]/10 border-b border-[#D4AF37]/20",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-black text-[#D4AF37] uppercase",children:"المستخدم"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-black text-[#D4AF37] uppercase",children:"المبلغ"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-black text-[#D4AF37] uppercase",children:"الوسيلة / الرقم"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-black text-[#D4AF37] uppercase",children:"الحالة"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-black text-[#D4AF37] uppercase",children:"التاريخ"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-black text-[#D4AF37] uppercase",children:"الإجراءات"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-white/5",children:0===c.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"px-6 py-20 text-center text-gray-500 text-sm",children:"لا توجد طلبات إيداع حالياً"})}):c.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[(0,t.jsxs)("td",{className:"px-6 py-4",children:[(0,t.jsx)("p",{className:"text-sm font-bold text-gray-200",children:e.userName}),(0,t.jsx)("p",{className:"text-[10px] text-gray-500",children:e.userEmail})]}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsxs)("span",{className:"text-sm font-black text-[#FFD700]",children:[e.amount.toLocaleString()," EGP"]})}),(0,t.jsxs)("td",{className:"px-6 py-4",children:[(0,t.jsx)("p",{className:"text-xs font-bold",children:e.method}),(0,t.jsx)("p",{className:"text-[10px] text-gray-500 tracking-widest",children:e.phone})]}),(0,t.jsxs)("td",{className:"px-6 py-4",children:[(0,t.jsx)("span",{className:`px-3 py-1 rounded-full text-[10px] font-bold uppercase ${"pending"===e.status?"bg-yellow-500/10 text-yellow-500":"completed"===e.status?"bg-green-500/10 text-green-500":"suspended"===e.status?"bg-blue-500/10 text-blue-500":"bg-red-500/10 text-red-500"}`,children:"pending"===e.status?"قيد الانتظار":"completed"===e.status?"مكتمل":"suspended"===e.status?"معلق":"مرفوض"}),e.reason&&(0,t.jsxs)("p",{className:"text-[9px] text-gray-600 mt-1 max-w-[150px] truncate",children:["السبب: ",e.reason]})]}),(0,t.jsx)("td",{className:"px-6 py-4 text-[10px] text-gray-500",children:e.createdAt?.toDate().toLocaleString("ar-EG")}),(0,t.jsx)("td",{className:"px-6 py-4",children:"pending"===e.status&&(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)("button",{onClick:()=>w(e),disabled:y,className:"bg-green-500 hover:bg-green-600 text-white p-2 rounded-lg text-xs font-bold transition-all",title:"تحويل",children:"✅ تحويل"}),(0,t.jsx)("button",{onClick:()=>{u(e),g("suspend"),h(!0)},disabled:y,className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-lg text-xs font-bold transition-all",title:"تعليق",children:"⏳ تعليق"}),(0,t.jsx)("button",{onClick:()=>{u(e),g("reject"),h(!0)},disabled:y,className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded-lg text-xs font-bold transition-all",title:"رفض",children:"❌ رفض"})]})})]},e.id))})]})})}),m&&(0,t.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-in fade-in duration-300",children:(0,t.jsxs)("div",{className:"bg-[#0d0d0d] border border-[#D4AF37]/30 p-8 rounded-[40px] w-full max-w-md space-y-6 shadow-[0_30px_100px_rgba(0,0,0,0.8)]",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h3",{className:"text-2xl font-black text-[#FFD700]",children:"reject"===b?"رفض الطلب":"تعليق الطلب"}),(0,t.jsx)("p",{className:"text-gray-500 text-xs uppercase mt-2",children:"يرجى توضيح السبب للمستخدم"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-[10px] font-black text-[#D4AF37] uppercase tracking-widest px-1",children:"السبب"}),(0,t.jsx)("textarea",{value:j,onChange:e=>f(e.target.value),placeholder:"reject"===b?"مثلاً: الرقم غير صحيح، لم يتم استلام التحويل...":"مثلاً: جار مراجعة التحويل مع البنك...",className:"w-full bg-black border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-[#D4AF37] min-h-[120px] text-sm transition-all"})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("button",{onClick:v,disabled:y||!j,className:`flex-1 py-4 rounded-2xl font-black text-xs transition-all ${"reject"===b?"bg-red-500 text-white shadow-[0_10px_20px_rgba(239,68,68,0.2)]":"bg-blue-500 text-white shadow-[0_10px_20px_rgba(59,130,246,0.2)]"}`,children:y?"جاري الحفظ...":"تأكيد الإجراء"}),(0,t.jsx)("button",{onClick:()=>{h(!1),f("")},className:"flex-1 py-4 rounded-2xl bg-white/5 text-gray-400 font-black text-xs hover:bg-white/10 transition-all border border-white/5",children:"إلغاء"})]})]})})]})}e.s(["default",()=>n])}]);